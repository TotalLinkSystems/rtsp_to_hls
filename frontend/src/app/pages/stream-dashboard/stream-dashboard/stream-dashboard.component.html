<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap JS Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<div class="p-6 container mx-auto flex flex-col">
    <h1 class="text-3xl font-bold mb-4">Stream Monitor</h1>

    <input class="form-control mb-3" type="text" [(ngModel)]="searchText" (input)="loadPreviews()"
        placeholder="Start searching for a stream by name..." />

    <div *ngIf="loading" class="text-gray-500">Loading...</div>

    <div *ngFor="let rec of records | filterByName:searchText" class="mb-4 p-4 border rounded shadow">
        <div class="row align-items-center">

            <!-- LEFT: Info -->
            <div class="col-9">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <strong>ID:</strong> {{ rec.id }} <br>
                        <strong>Name:</strong> {{ rec.name }} <br>
                        <strong>PID:</strong> {{ rec.pid || 'â€”' }} <br>
                        <strong>Status:</strong>
                        <span [class.text-success]="rec.pid" [class.text-danger]="!rec.pid">
                            {{ rec.pid ? 'Running' : 'Stopped' }}
                        </span>
                    </div>

                    <div>
                        <span class="live-dot" [class.running]="rec.pid" [class.stopped]="!rec.pid"></span>
                    </div>
                </div>

                <div class="mt-2 d-flex align-items-center gap-2">
                    <strong>Stream URL:</strong>
                    <span class="text-break">{{ getStreamUrl(rec) }}</span>

                    <button class="btn btn-light p-1 position-relative copy-btn"
                        (click)="copyToClipboard(getStreamUrl(rec), rec.id)">
                        <i class="bi bi-clipboard" [class.hidden]="copiedId === rec.id"></i>
                        <i class="bi bi-check-lg text-success checkmark-icon" [class.hidden]="copiedId !== rec.id"></i>
                    </button>
                    <span *ngIf="copiedId === rec.id" class="text-success small">Copied!</span>
                </div>

                <div class="mt-3 text-center">
                    <button class="btn btn-primary mx-2" [disabled]="rec.pid" (click)="start(rec)">Start</button>
                    <button class="btn btn-primary mx-2" [disabled]="!rec.pid" (click)="restart(rec)">Restart</button>
                    <button class="btn btn-primary mx-2" [disabled]="!rec.pid" (click)="stop(rec)">Stop</button>
                </div>
            </div>

            <!-- RIGHT: Preview -->
            <div class="col-3 d-flex justify-content-center position-relative">

                <video [id]="'preview-' + rec.id" class="border rounded preview-video" width="160" height="250" muted
                    playsinline (click)="openModal(rec)">
                </video>

                <span class="badge bg-danger position-absolute top-0 start-0 m-1">LIVE</span>
            </div>

        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="streamModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content bg-dark">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">{{ selectedStream?.name }}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <video #modalVideo class="w-100" controls autoplay muted playsinline></video>
                </div>
            </div>
        </div>
    </div>
</div>